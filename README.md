# Математическая модель игры Доббль

## Уровни сложности чтения

* Я слишком молод, чтобы думать
  * [Введение и правила игры](#%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Как они это делают?](#%D0%9A%D0%B0%D0%BA-%D0%BE%D0%BD%D0%B8-%D1%8D%D1%82%D0%BE-%D0%B4%D0%B5%D0%BB%D0%B0%D1%8E%D1%82)
  * [Матрица инцидентности для игры Доббль](#%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0-%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%B3%D1%80%D1%8B-%D0%94%D0%BE%D0%B1%D0%B1%D0%BB%D1%8C)
  * [Каких двух карточек не хватает в комплекте игры?](#%D0%9A%D0%B0%D0%BA%D0%B8%D1%85-%D0%B4%D0%B2%D1%83%D1%85-%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%B5%D0%BA-%D0%BD%D0%B5-%D1%85%D0%B2%D0%B0%D1%82%D0%B0%D0%B5%D1%82-%D0%B2-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BB%D0%B5%D0%BA%D1%82%D0%B5-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Благодарности](#%D0%91%D0%BB%D0%B0%D0%B3%D0%BE%D0%B4%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D0%B8)

* Сделай мне умно
  * [Введение и правила игры](#%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Как они это делают?](#%D0%9A%D0%B0%D0%BA-%D0%BE%D0%BD%D0%B8-%D1%8D%D1%82%D0%BE-%D0%B4%D0%B5%D0%BB%D0%B0%D1%8E%D1%82)
  * [При чём тут карточки?](#%D0%9F%D1%80%D0%B8-%D1%87%D1%91%D0%BC-%D1%82%D1%83%D1%82-%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B8)
  * [Проективные плоскости малых порядков](#%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D1%81%D1%82%D0%B8-%D0%BC%D0%B0%D0%BB%D1%8B%D1%85-%D0%BF%D0%BE%D1%80%D1%8F%D0%B4%D0%BA%D0%BE%D0%B2)
  * [Матрица инцидентности для игры Доббль](#%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0-%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%B3%D1%80%D1%8B-%D0%94%D0%BE%D0%B1%D0%B1%D0%BB%D1%8C)
  * [Каких двух карточек не хватает в комплекте игры?](#%D0%9A%D0%B0%D0%BA%D0%B8%D1%85-%D0%B4%D0%B2%D1%83%D1%85-%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%B5%D0%BA-%D0%BD%D0%B5-%D1%85%D0%B2%D0%B0%D1%82%D0%B0%D0%B5%D1%82-%D0%B2-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BB%D0%B5%D0%BA%D1%82%D0%B5-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Благодарности](#%D0%91%D0%BB%D0%B0%D0%B3%D0%BE%D0%B4%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D0%B8)

* Кошмар
  * [Введение и правила игры](#%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Как они это делают?](#%D0%9A%D0%B0%D0%BA-%D0%BE%D0%BD%D0%B8-%D1%8D%D1%82%D0%BE-%D0%B4%D0%B5%D0%BB%D0%B0%D1%8E%D1%82)
  * [Конечная геометрия для грудничков](#%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F-%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F-%D0%B4%D0%BB%D1%8F-%D0%B3%D1%80%D1%83%D0%B4%D0%BD%D0%B8%D1%87%D0%BA%D0%BE%D0%B2)
  * [При чём тут карточки?](#%D0%9F%D1%80%D0%B8-%D1%87%D1%91%D0%BC-%D1%82%D1%83%D1%82-%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B8)
  * [Проективные плоскости малых порядков](#%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D1%81%D1%82%D0%B8-%D0%BC%D0%B0%D0%BB%D1%8B%D1%85-%D0%BF%D0%BE%D1%80%D1%8F%D0%B4%D0%BA%D0%BE%D0%B2)
  * [Как построить проективную плоскость?](#%D0%9A%D0%B0%D0%BA-%D0%BF%D0%BE%D1%81%D1%82%D1%80%D0%BE%D0%B8%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%83%D1%8E-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D1%81%D1%82%D1%8C)
  * [Матрица инцидентности для игры Доббль](#%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0-%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%B3%D1%80%D1%8B-%D0%94%D0%BE%D0%B1%D0%B1%D0%BB%D1%8C)
  * [Каких двух карточек не хватает в комплекте игры?](#%D0%9A%D0%B0%D0%BA%D0%B8%D1%85-%D0%B4%D0%B2%D1%83%D1%85-%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%B5%D0%BA-%D0%BD%D0%B5-%D1%85%D0%B2%D0%B0%D1%82%D0%B0%D0%B5%D1%82-%D0%B2-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BB%D0%B5%D0%BA%D1%82%D0%B5-%D0%B8%D0%B3%D1%80%D1%8B)
  * [Благодарности](#%D0%91%D0%BB%D0%B0%D0%B3%D0%BE%D0%B4%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D0%B8)

## Введение и правила игры

Несколько лет назад я купил игру [Доббль](http://www.igroved.ru/games/dobble/) ([Dobble](https://boardgamegeek.com/boardgame/63268/spot-it), оригинальное название “Spot It!”). Это очень простая, быстрая и весёлая игра, которую я считаю одной из лучших настольных игр вообще.  
В комплекте игры 55 карточек с 8 разными символами на каждой. Вот как выглядят эти карточки:


![Card 1](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble1.png) ![Card 2](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble2.png)

_Рис. 1._ Пример карточек игры.

На каждых двух карточках совпадает один и только один символ. На приведённом рисунке это символ карандаша:

![Card 1 symbol 1-2](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble1_symbol1-2.png) ![Card 2 symbol 1-2](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble2_symbol1-2.png)

_Рис. 2._ Совпадающие символы на карточках.

Игрок, первый увидевший совпадение, делает с одной из карточек действие, зависящее от тура игры. Например, забирает её себе или подкидывает сопернику.  
Часто это приводит к тому, что одна из карточек, для которой игроки ищут совпадения, меняется. Из-за этого приходится искать новое совпадение, которое может быть совсем другим символом:

![Card 3](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble3.png) ![Card 2](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble2.png) 

![Card 3 symbol2-3](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble3_symbol2-3.png) ![Card 2 symbol2-3](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble2_symbol2-3.png)

_Рис. 3, 4._ Первая карточка заменяется на новую. Теперь между ними новое совпадение - символ клоуна.

## Как они это делают?

На первый взгляд, кажется невероятным, что на двух карточках ровно одно совпадение, ни больше, ни меньше. Сразу возникают вопросы - сколько всего символов в игре? Их не может быть слишком мало (тогда на карточках будет больше одного совпадения) или слишком много (тогда на карточках может вообще не оказаться совпадений).  
Кроме того, очевидно, что символы расположены на карточках в особом порядке, который гарантирует единственное совпадение для любых двух карточек.

Элементарные навыки гугл-фу приводят нас на сайт stackoverflow, где описано, почему так происходит: http://stackoverflow.com/questions/6240113/what-are-the-mathematical-computational-principles-behind-this-game

В игре используются принципы [конечной геометрии](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F). Хотя в этом словосочетании есть слово “геометрия”, это понятие относится больше к комбинаторике, чем к геометрии. Она оперирует конечным количеством точек, которые могут располагаться, в частности, в виде [проективной плоскости](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F_%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D1%81%D1%82%D1%8C).

Карточки и символы в игре являются элементами проективной плоскости 7 порядка. Это значит, что на каждой карточке __n+1__ символ, а общее количество уникальных символов в игре - __n^2+n+1__, т.е. 57 символов.

Существуют плоскости как более низких, так и более высоких порядков. Например, существует плоскость 5 порядка. Для неё на карточке изображены 6 символов, а общее количество уникальных символов в игре - 5^2+5+1 = 31. Проективная плоскость такой конфигурации используется в более простом варианте игры Доббль под названием [“Доббль 1,2,3”](http://www.igroved.ru/games/dobble-1-2-3/).

Связь между точками и линиями для проективной плоскости задаётся при помощи [матрицы инцидентности](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0_%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8). Её вид представлен в разделе [“Матрица инцидентности для игры Доббль”](https://github.com/Skybladev2/DobbleMathModel/blob/master/README.md#%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0-%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%B3%D1%80%D1%8B-%D0%94%D0%BE%D0%B1%D0%B1%D0%BB%D1%8C).

## Конечная геометрия для грудничков
Сначала зайдём на википедию и почитаем несколько статей. Первая статья описывает понятие конечной геометрии:

> __Конечная геометрия__ — это любая геометрическая система, имеющая [конечное](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BC%D0%BD%D0%BE%D0%B6%D0%B5%D1%81%D1%82%D0%B2%D0%BE) количество [точек](https://ru.wikipedia.org/wiki/%D0%A2%D0%BE%D1%87%D0%BA%D0%B0_%28%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F%29). [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Пока всё просто. Если ручкой на бумаге нарисовать несколько точек, то они уже будут составлять некую конечную геометрию.  
Дальше многих ждёт сюрприз:

>Например, [евклидова геометрия](https://ru.wikipedia.org/wiki/%D0%95%D0%B2%D0%BA%D0%BB%D0%B8%D0%B4%D0%BE%D0%B2%D0%B0_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F) не является конечной, так как [евклидова прямая](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D1%8F%D0%BC%D0%B0%D1%8F#.D0.A1.D0.B2.D0.BE.D0.B9.D1.81.D1.82.D0.B2.D0.B0_.D0.BF.D1.80.D1.8F.D0.BC.D0.BE.D0.B9_.D0.B2_.D0.B5.D0.B2.D0.BA.D0.BB.D0.B8.D0.B4.D0.BE.D0.B2.D0.BE.D0.B9_.D0.B3.D0.B5.D0.BE.D0.BC.D0.B5.D1.82.D1.80.D0.B8.D0.B8) содержит неограниченное число точек, а точнее говоря, содержит ровно столько точек, сколько существует [вещественных чисел](https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D0%B5_%D1%87%D0%B8%D1%81%D0%BB%D0%BE). [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Для нас это значит, что тот листок бумаги, на котором нарисованы наши точки, __не является плоскостью с точки зрения конечной геометрии__. Это просто носитель точек.

>Существуют два вида геометрии на плоскости: [аффинная](https://ru.wikipedia.org/wiki/%D0%90%D1%84%D1%84%D0%B8%D0%BD%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F) и [проективная](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F). В аффинной геометрии используется обычное понятие параллельности прямых. [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Вспомним, какими аксиомами описывается афинная геометрия:

>Аффинная геометрия на плоскости — это непустое множество _**X**_ (элементы которого называются «точками»), с непустым набором _**L**_  подмножеств _**X**_ (элементы которого называются «прямая»), таких, что:
>1. Для двух различных точек существует только одна прямая, которая содержит обе точки.
>2. Для прямой _**ℓ**_ и точки _**p**_, не принадлежащей _**ℓ**_, существует одна и только одна прямая _**ℓ′**_, содержащая _**p**_, такая, что _**ℓ**_ ∩ _**ℓ′**_ = ∅ .
>3. Существует множество из четырёх точек, никакие три из которых не лежат на одной прямой. [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Эти аксиомы дают нам возможность понять, как выглядит простейшая афинная плоскость в конечной геометрии:

>Простейшая аффинная плоскость содержит лишь 4 точки, и называется _аффинной плоскостью второго порядка_. Каждая пара точек определяет уникальную прямую, поэтому указанная плоскость содержит 6 прямых. [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Не очень понятно? Всё верно. Если присмотреться к определению афинной геометрии, то можно заметить, что она оперирует с понятиями теории множеств (элемент, множество, подмножество).
Это значит, что прямые могут выглядеть совсем не как привычные прямые Евклидовой геометрии.

На самом деле так и есть. Если взглянуть на рисунок афинной плоскости второго порядка, то мы увидим такую картину:

![Order 2 affine plane](https://upload.wikimedia.org/wikipedia/ru/6/63/Order_2_affine_plane.svg.png)

_Рис. 5._ Афинная плоскость второго порядка. (Источник [ru.wikipedia.org](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F#/media/File:Order_2_affine_plane.svg.png))

Точки здесь выглядят как обычные чёрные точки, а вот прямые - это разноцветные отрезки. Прямые одинакового цвета считаются параллельными.  
Как легко заметить, прямые тут не бесконечной длины. По секрету скажу, что понятия длины тут вообще нет, а прямые могут иметь любую форму, как мы вскоре увидим.

Наверняка %username% до сих пор сомневается, что изображение этой плоскости удовлетворяет аксиомам афинной геометрии. Давайте проверим:
1. Берём 2 любых точки, например, левую верхнюю и левую нижнюю.  
Обе эти точки содержит только одна левая красная прямая.  
Правая красная прямая не содержит ни одной из этих точек, а остальные прямые содержат только одну из них.
2. Берём левую красную прямую и правую верхнюю точку. Очевидно, что только одна прямая (правая красная) параллельна левой красной прямой, так как проходит через правую верхнюю точку, но не проходит ни через одну из двух левых точек.
3. На рисунке хорошо видно, что какие бы 3 точки мы ни взяли, одна из них лежит на прямой, отличной от прямой, на которой лежат __обе__ другие точки.
Две прямых, составляющие диагонали квадрата, не пересекаются, так как не имеют общих точек.

Если вы хорошо поняли содержание предыдущей картинки, то вот картинка посложней:

![Order 3 affine plane](https://upload.wikimedia.org/wikipedia/ru/9/9d/Order_3_affine_plane.svg.png)

_Рис. 6._ Афинная плоскость третьего порядка. (Источник [ru.wikipedia.org](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F#/media/File:Order_3_affine_plane.svg.png))

Здесь мы видим 9 точек и 12 прямых. Да-да, %username%, эти эллипсы - на самом деле прямые в терминах конечной геометрии.
Фигуры одинакового цвета - это параллельные прямые. Их трудно заметить, поэтому разделим картинку на несколько:

| Плоскость №1 | Плоскость №2 | Плоскость №3 | Плоскость №4 |
| :---: | :---: | :---: | :---: | 
| ![Order 3 affine plane red](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Order_3_affine_plane_red_small.png) | ![Order 3 affine plane blue](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Order_3_affine_plane_blue_small.png) | ![Order 3 affine plane green](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Order_3_affine_plane_green_small.png) | ![Order 3 affine plane violet.png](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Order_3_affine_plane_violet_small.png)

_Рис. 7._ Параллельные прямые афинной плоскости третьего порядка.

Здесь проверка выполнения аксиом займёт чуть больше времени:
1. Берём 2 любых точки, например, центральную верхнюю и правую нижнюю. Через них проходит только одна из фиолетовых прямых.
2. Берём левую красную прямую и правую нижнюю точку. Аналогично плоскости второго порядка, только одна правая красная прямая проходит через эту точку, но не проходит ни через одну из трёх левых точек.
3. Здесь чуть сложнее, чем в случае с плоскостью 2 порядка. Формулировка аксиомы гласит, что нужно найти хотя бы одно (непустое) множество из четырёх точек, в котором никакие три не лежат не одной прямой.  
Очевидно, что 12 множеств с тремя точками, через которых проходят линии на рисунке, не удовлетворяют этому условию. Но ему удовлетворяет, например, множество из четырёх угловых точек.

>В более общем случае, конечная аффинная плоскость порядка _**n**_ имеет _**n^2**_ точек и _**n^2 + n**_ прямых; каждая прямая содержит _**n**_ точек, и каждая точка принадлежит _**n + 1**_ прямой. [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

С афинной геометрией закончили, переходим ко второму типу геометрии на плоскости - проективной.

>В проективной геометрии наоборот, любые две прямые пересекаются в единственно возможной точке, и потому параллельных прямых не существует. [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

Предыдущее предложение описывает вторую аксиому проективной геометрии. Первая и третья - такие же, как в афинной.

>Поскольку третья аксиома требует существования как минимум четырёх точек, плоскость должна содержать как минимум 7 точек, чтобы удовлетворить условиям первых двух аксиом. В этой простейшей из проективных плоскостей имеется также 7 прямых; каждая точка принадлежит трём прямым, и каждая прямая содержит три точки. Такую проективную плоскость часто называют ["плоскостью Фано"](https://ru.wikipedia.org/wiki/%D0%9F%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D1%81%D1%82%D1%8C_%D0%A4%D0%B0%D0%BD%D0%BE). [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

![Fano plane](https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/Fano_plane.svg/480px-Fano_plane.svg.png)

_Рис. 8._ Плоскость Фано. (Источник [en.wikipedia.org](https://en.wikipedia.org/wiki/Finite_geometry#/media/File:Fano_plane.svg))

На этом рисунке сложно сразу разобрать все 7 прямых, так что вот пони-вариант той же плоскости:

![Colored Fano plane](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/FanoColor.png)

_Рис. 9._ Плоскость Фано с раскрашенными прямыми. (Источник [mathpuzzle.com](http://www.mathpuzzle.com/MAA/47-Fano/mathgames_05_30_06.html). Используется с разрешения [Ed Pegg Jr](ed@mathpuzzle.com).)

Итак, плоскость Фано - это проективная плоскость 2 порядка с 7 точками и 7 линиями.

## При чём тут карточки?

Что будет, если мы переформулируем 2 аксиомы [конечной геометрии](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F), заменив “прямую” на “символ” и “точку” на “карточку”?

Получится вот что:
1. Для двух различных карточек существует только один символ, который изображён на обеих карточках.
2. Для двух различных символов существует только одна карточка, которая содержит оба этих символа.

Теперь на основе этих знаний посмотрим, как выглядел бы Доббль в простейшем случае. В нём было бы 7 карточек и 7 символов, на каждой карточке было бы по 3 символа (т.к. в одной точке пересекаются 3 прямые):

![Dobble Fano plane](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Fano%20plane.png)

_Рис. 10._ Пример минимально возможного набора карточек для Доббля.

Тут используются следующие 7 символов:

![anchor](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/anchor.png), ![apple](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/apple.png), ![bird](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/bird.png), ![cheese](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/cheese.png), ![drop](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/drop.png), ![exclamation](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/exclamation.png), ![heart](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/heart.png)

Какие бы 2 карточки мы ни взяли, они будут иметь общий символ, изображённый рядом с прямой, на которой лежат обе карточки.  
Например, у карточки в левом нижнем углу и карточки в середине правой грани общий символ ![bird](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/bird.png). Он изображён рядом с прямой ![line](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/line.png).

## Проективные плоскости малых порядков

На сайте Wolfram можно найти визуальную демонстрацию проективных плоскостей малых порядков: http://demonstrations.wolfram.com/ProjectivePlanesOfLowOrder/
Она оформлена в виде документа в формате CDF (Computable Document Format), для которого нужно установить [CDF Player](http://demonstrations.wolfram.com/download-cdf-player.html).

Вот пример проективной плоскости 3 порядка:

![PP3](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/ProjectivePlane3.png)

_Рис. 11._ Изображение проективной плоскости 3 порядка.

Трудно понять, что происходит, поэтому возьмём 2 произвольные прямые:

![PP3Lines](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/ProjectivePlane3Lines.png)

_Рис. 12._ Пересечение двух линий проективной плоскости 3 порядка.

Как мы видим, они пересекаются ровно в одной точке. Сами линии содержат по 4 точки.  
Чтобы убедиться, что через каждую точку проходит 4 прямые, придётся переключать отображаемые пары прямых в интерактивном документе и сосредоточить внимание на какой-то точке.

Проективные плоскости более высоких порядков изображены на рисунках ниже.

![PP4](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/ProjectivePlaneOrder4.png)

_Рис. 13._ Проективная плоскость порядка 4

![PP5](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/ProjectivePlaneOrder5.png)

_Рис. 14._ Проективная плоскость порядка 5

![PP7](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/ProjectivePlaneOrder7.png)

_Рис. 15._ Проективная плоскость порядка 7

В приведённой последовательности отсутствует изображение для проективной плоскости 6 порядка. Это не ошибка.  
Хотя Wolfram генерирует графическое представление такой структуры, она не удовлетворяет аксиомам проективной геометрии, и не является проективной плоскостью.

Предполагается, но до сих пор не доказано, что порядок конечной плоскости всегда является [степенью простого числа](https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D1%8C_%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B3%D0%BE_%D1%87%D0%B8%D1%81%D0%BB%D0%B0). [[1]](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F)

## Как построить проективную плоскость?

Графическое представление проективной плоскости выглядит интересно и наглядно, но как найти такую комбинацию точек, чтобы она обладала вышеописанными свойствами?
Проще всего - посетив сайты, где размещены [предрасчитанные данные для проективных плоскостей разных порядков](https://www.uwyo.edu/moorhouse/pub/planes/).

Например, для проективной плоскости 7 порядка можно посетить такую страницу: https://www.uwyo.edu/moorhouse/pub/planes/pg27.txt  
Там представлена матрица из чисел. Строки - это карточки (точки) в понятиях Доббля. Числа в строках - это порядковые номера символов (линий), начиная с нуля, которые нарисованы на каждой карточке (проходят через данную точку).

Также можно воспользоваться услугами математических пакетов, таких, как Matlab, чтобы построить матрицу инцидентности проективной плоскости. [[2]](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0_%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8) [[3]](http://www.m-hikari.com/imf/imf-2016/1-4-2016/p/akcaIMF1-4-2016.pdf)

### Матрицы инцидентности

>__Матрица инцидентности__ — одна из форм представления [графа](https://ru.wikipedia.org/wiki/%D0%93%D1%80%D0%B0%D1%84_%28%D0%BC%D0%B0%D1%82%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0%29), в которой указываются связи между инцидентными элементами графа (ребро(дуга) и вершина). Столбцы матрицы соответствуют ребрам, строки — вершинам. Ненулевое значение в ячейке матрицы указывает связь между вершиной и ребром (их [инцидентность](https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C)). [[2]](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0_%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8)

Одним из простейших примеров матрицы инцидентности может служить матрица размером 2х1 для неориентированного графа из двух вершин, соединённых одним ребром:

![Simaple graph incidende matrix](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Simple%20graph%20and%20incidence%20matrix.png)

_Рис. 16._ Неориентированный граф из двух вершин, соединённых одним ребром, и его матрица инцидентности.

Более сложный пример графа и его матрицы инцидентности:

![Advanced graph](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Graph%20advanced.png)

_Рис. 17._ Неориентированный граф с 4-мя вершинами и его матрица инцидентности.

Как видно из последнего примера, в матрице инцидентности графа в каждом столбце ровно две единицы, т.к. одно ребро соединяет две вершины.  
Проективная плоскость является [гиперграфом](https://ru.wikipedia.org/wiki/%D0%93%D0%B8%D0%BF%D0%B5%D1%80%D0%B3%D1%80%D0%B0%D1%84), так как одна прямая (ребро) соединяет несколько точек (вершин). Поэтому в матрице инцидентности проективной плоскости единицы в каждом столбце встречаются _n+1_ раз, где _n_ - порядок проективной плоскости.

Для плоскости Фано, изображённой на рис. 9, матрица инцидентности будет иметь следующий вид:

![Fano plane incidence matrix](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Fano%20plane%20incidence%20matrix.png)

_Рис. 18._ Матрица инцидентности плоскости Фано.

Для упрощения восприятия нули не показаны, а единицы заменены на символ _**Х**_.
В таком представлении проективной плоскости хорошо заметен [принцип двойственности точек и прямых](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%8F#.D0.9A.D0.BE.D0.BD.D0.B5.D1.87.D0.BD.D1.8B.D0.B5_.D0.BF.D0.BB.D0.BE.D1.81.D0.BA.D0.BE.D1.81.D1.82.D0.B8) - прямая проходит ровно через 3 точки, и, в то же время, точка принадлежит ровно трём прямым.

### Построение проективной плоскости перебором

Текущих знаний о свойствах матрицы инцидентности достаточно, чтобы построить её для проективной плоскости любого порядка n. Для этого можно использовать следующий псевдокод:

```
Для всех столбцов
    Для всех строк
        Если в столбце стоит n+1 единиц, то перейти к следующему столбцу
        Если в строке стоит n+1 единиц, то перейти к следующей строке
        Для каждого предыдущего столбца Х
            Если в столбце Х на текущей строке стоит единица
            и
            Если уже есть совпадения в строках для столбца Х и текущего столбца,
                то перейти к следующей строке
        Поставить единицу
    Перейти на следующую строку
Перейти на следующий столбец
```

Следуя этому алгоритму, мы получим [симметричную матрицу](https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F_%D0%BC%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0) для плоскости Фано:

![Fano plane symmetric incidence matrix](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Fano%20plane%20incidence%20matrix%20symmetric.png)

_Рис. 19._ Матрица инцидентности плоскости Фано, построенная по алгоритму псевдокода.

Эта матрица не совпадает с предыдущей. На самом деле, это неважно.  
Перестановка любых двух строк матрицы инцидентности равносильна перенумерации вершин графа.  
Перестановка любых двух столбцов матрицы инцидентности равносильна перенумерации рёбер графа (если их заранее пронумеровать).

## Матрица инцидентности для игры Доббль

Для игры Доббль в [матрице инцидентности](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%82%D1%80%D0%B8%D1%86%D0%B0_%D0%B8%D0%BD%D1%86%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8) строки отвечают за карточки, а столбцы - за символы на них.  
Таким образом, перестановка любых двух столбцов матрицы инцидентности равносильна изменению очерёдности следования символов на карточке. Однако, символы на карточке неупорядочены, поэтому данная операция не влияет на внешний вид карточек.  
Перестановка двух строк означает, что на всех карточках два соответствующих символа заменяют друг друга.

Последняя операция меняет внешний вид карточек, а значит, что тот набор символов, который мы видим в игре - лишь одна из возможных комбинаций.  
Количество наборов символов для отдельно взятой карточки есть сочетание без повторений из 57 элементов по 8 элементам. Оно вычисляется по формуле ![formula](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/formulas/latex_9d86fb0fd0191eaa06adb5e748305fea.png)

Матрица инцидентности для игры Доббль показана в таблице ниже. Она транспонирована, т.е. строки - это символы, а столбцы - это карточки (картинка кликабельна).

[![Dobble incidence matrix](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble%20incidence%20matrix.png)](https://docs.google.com/spreadsheets/d/1Q8hLbHeMlaMWF3xCpiJsG3wa68WOFUXp9Bts_xAuZt4/edit#gid=0)
   
 _Рис. 20._ Матрица инцидентности игры Доббль.

## Каких двух карточек не хватает в комплекте игры?

Всего в таблице с матрицей инцидентности игры 57 строк и 55 столбцов. Это значит, что в игре могло быть ещё 2 карточки.  
Значит, символы, которые должны быть на этих карточках, встречаются в игре реже, чем остальные. Количество символов в игре показано в последнем столбце таблицы.

Количество символов с недостающих карточек таково:

* ![bulb](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/bulb.png), ![cactus](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/cactus.png), ![chamomilae](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/chamomilae.png), ![dinosaur](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/dinosaur.png), ![dog](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/dog.png), ![exclamation](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/exclamation.png), ![eye](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/eye.png), ![hammer](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/hammer.png), ![human](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/human.png), ![ice](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/ice.png), ![ladybug](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/ladybug.png), ![leaf](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/leaf.png), ![question](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/question.png) и ![skull](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/skull.png)  
(всего 14 символов) встречаются по 7 раз.
* ![snowman](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/symbols/showman.png) встречается 6 раз.

Как выглядят недостающие карточки? Для ответа на этот вопрос возьмём любой из представленных выше символов в матрице инцидентности (кроме снеговика), и поместим его на недостающую карточку (например, предпоследний столбец).  
Затем найдём все карточки (столбцы), на которых изображён этот символ. Это значит, на всех этих карточках символы совпадают, и других совпадений быть не может.  
Так как на этих карточках уже есть совпадение с выбранным символом, вычеркнем из предпоследнего столбца все символы, которые встречаются на остальных карточках.  
Недостающие символы, которые не были вычеркнуты, и составляют символы одной из оставшихся карточек. Так как их получилось ровно 8, то вид второй недостающей карточки определяется однозначно.  

Вот эти 2 карточки:

![Card 56](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble56.png) ![Card 57](https://github.com/Skybladev2/DobbleMathModel/blob/master/images/Dobble57.png)

_Рис. 21._ Возможный вид недостающих карточек №56 и №57.

Осталось ответить на последний вопрос - не влияет ли отсутствие этих карточек на свойство совпадения единственного символа между двумя карточками (т.е. вдруг между какими-то карточками нет совпадений)?
Ответ на него очевиден, если ещё взглянуть на матрицу инцидентности игры - нет, не влияет. Между любыми двумя карточками (столбцами) по-прежнему единственное совпадение.

## Благодарности

Выражаю огромную благодарность [сети магазинов настольных игр “Игровед”](http://www.igroved.ru/) за помощь в написании статьи.  
Благодарю Ed Pegg Jr за предоставленное изображение плоскости Фано.  
Отдельно хочу отметить одного анонимуса и Master-а за помощь в проверке статьи.  
Благодарю [магазин "Настольный град"](https://vk.com/nastolny_grad) за помощь в подготовке к публикации статьи.  
От всего сердца благодарю авторов игры Igor Polouchine и Denis Blanchot, а также компанию [Asmodee](https://www.asmodee.com/) за предоставленное право на использование изображений из игры.

***
Исходный текст статьи находится по адресу https://github.com/Skybladev2/DobbleMathModel/blob/master/README.md  

© 2017 Skyblade
